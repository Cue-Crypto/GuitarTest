<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Wicked Ass Auditory - Gear And Hear</title>
<style>
  body {
    margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #121212; color: #ddd;
    display: flex; flex-direction: column; min-height: 100vh;
  }
  header {
    background-color: #1c1c1c;
    border-bottom: 2px solid #b22222;
    padding: 1rem 2rem;
    display: flex; justify-content: space-between; align-items: center;
  }
  .logo {
    display: flex; align-items: center; gap: 0.5rem;
  }
  .logo img {
    width: 48px; height: 48px;
  }
  .logo h1 {
    color: #b22222; font-size: 1.5rem; user-select: none;
  }
  nav a, #auth-status span {
    color: #ddd; margin-left: 1rem; text-decoration: none;
    font-weight: 600; cursor: pointer;
    user-select: none;
  }
  nav a.active, nav a:hover {
    color: #b22222;
  }
  main {
    flex: 1; padding: 1rem 2rem;
    max-width: 960px; margin: 0 auto;
  }
  h2, h3 {
    color: #b22222;
    margin-bottom: 1rem;
  }
  .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(240px,1fr));
    gap: 1.5rem;
  }
  .product-card {
    background-color: #222;
    border: 1px solid #b22222;
    border-radius: 6px;
    padding: 1rem;
    text-align: center;
  }
  .product-card img {
    max-width: 100%;
    border-radius: 4px;
    margin-bottom: 1rem;
  }
  .product-card h4 {
    margin-bottom: 0.5rem;
  }
  button {
    background-color: #b22222;
    color: #121212;
    border: none;
    padding: 0.5rem 1rem;
    font-weight: 700;
    border-radius: 4px;
    cursor: pointer;
  }
  button:disabled {
    background-color: #555;
    cursor: not-allowed;
  }
  #cart-section {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #222;
    border: 2px solid #b22222;
    padding: 1.5rem;
    border-radius: 8px;
    color: #ddd;
    width: 90vw;
    max-width: 420px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 0 15px #b22222cc;
    z-index: 9999;
    display: none;
  }
  #cart-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: rgba(0,0,0,0.7);
    z-index: 9998;
    display: none;
  }
  .cart-item {
    display: flex; justify-content: space-between; margin-bottom: 0.5rem;
  }
  .cart-item button {
    background-color: #7f0000;
    padding: 0 6px;
    font-weight: 900;
  }
  #auth-section {
    margin: 1rem 0 2rem;
    background-color: #222;
    padding: 1rem;
    border-radius: 6px;
    max-width: 400px;
  }
  #auth-section input {
    width: 100%;
    margin-bottom: 0.5rem;
    padding: 0.5rem;
    border-radius: 4px;
    border: none;
  }
  #auth-section button {
    width: 100%;
    margin-top: 0.5rem;
  }
  #auth-status {
    display: flex;
    align-items: center;
    gap: 1rem;
  }
  #auth-status span {
    user-select: none;
  }
  #promo-code-input {
    margin-right: 8px;
    padding: 0.4rem;
    border-radius: 4px;
    border: none;
    width: 140px;
  }
  #apply-promo-btn {
    background-color: #b22222;
    color: #121212;
    border: none;
    padding: 0.4rem 0.8rem;
    border-radius: 4px;
    cursor: pointer;
  }
  #apply-promo-btn:hover {
    background-color: #7f0000;
  }
  #promo-message {
    color: #b22222;
    margin-top: 0.5rem;
  }
  #close-cart-btn {
    margin-top: 1rem;
    background: #555;
    color: #ddd;
    border: none;
    padding: 0.4rem 0.8rem;
    border-radius: 4px;
    cursor: pointer;
  }
  #shipping-form {
    margin-top: 1rem;
    background-color: #333;
    padding: 0.8rem;
    border-radius: 6px;
    color: #ddd;
  }
  #shipping-form label {
    display: block;
    margin: 0.4rem 0 0.1rem;
  }
  #shipping-form input {
    width: 100%;
    padding: 0.4rem;
    border-radius: 4px;
    border: none;
    margin-bottom: 0.6rem;
  }
  footer {
    background: #1c1c1c;
    color: #bbb;
    text-align: center;
    padding: 1rem;
    margin-top: auto;
  }
  footer a {
    color: #b22222;
    text-decoration: none;
  }
  footer a:hover {
    text-decoration: underline;
  }
  @media (max-width: 480px) {
    #cart-section {
      width: 95vw;
      max-height: 90vh;
    }
  }
</style>
<link rel="icon" href="favicon.ico" />
</head>
<body>

<header>
  <div class="logo">
    <img src="logo.svg" alt="Wicked Ass Auditory logo" />
    <h1>Wicked Ass Auditory</h1>
  </div>
  <nav>
    <a href="#" class="active" id="home-link">Home</a>
    <a href="#shop" id="shop-link">Shop</a>
    <a href="#cart" id="cart-link">Cart (<span id="cart-count">0</span>)</a>
  </nav>
  <div id="auth-status"></div>
</header>

<main>
  <section class="hero">
    <h2>Gear And Hear</h2>
    <p>Find the best guitars, amps, mics, pickups, and accessories here.</p>
  </section>

  <section id="auth-section">
    <h3>User Account</h3>
    <div id="user-info" style="display:none;">
      Logged in as <strong id="user-email"></strong>
      <button id="logout-btn">Logout</button>
    </div>
    <div id="login-form">
      <input type="email" id="email" placeholder="Email" required />
      <input type="password" id="password" placeholder="Password" required />
      <button id="login-btn">Login</button>
      <button id="signup-btn">Sign Up</button>
      <p id="auth-message"></p>
    </div>
  </section>

  <section id="shop" class="featured-products">
    <h3>Featured Products</h3>
    <div class="products-grid" id="products-list">
      <!-- Products loaded by JS -->
    </div>
  </section>

  <section id="cart-section" role="dialog" aria-modal="true" aria-labelledby="cart-title">
    <h3 id="cart-title">Your Cart</h3>
    <div id="cart-items"></div>
    <p><strong>Total: $<span id="cart-total">0.00</span></strong></p>
    <input type="text" id="promo-code-input" placeholder="Enter promo code" aria-label="Promo code" />
    <button id="apply-promo-btn">Apply Promo</button>
    <p id="promo-message" aria-live="polite"></p>

    <form id="shipping-form" aria-label="Shipping Address Form" novalidate>
      <h4>Shipping Address</h4>
      <label for="full-name">Full Name</label>
      <input type="text" id="full-name" name="fullName" placeholder="John Doe" required />
      <label for="address-line1">Address Line 1</label>
      <input type="text" id="address-line1" name="addressLine1" placeholder="123 Main St" required />
      <label for="address-line2">Address Line 2</label>
      <input type="text" id="address-line2" name="addressLine2" placeholder="Apartment, suite, etc. (optional)" />
      <label for="city">City</label>
      <input type="text" id="city" name="city" placeholder="Anytown" required />
      <label for="state">State/Province</label>
      <input type="text" id="state" name="state" placeholder="CA" required />
      <label for="zip">Zip/Postal Code</label>
      <input type="text" id="zip" name="zip" placeholder="90210" required />
      <label for="country">Country</label>
      <input type="text" id="country" name="country" placeholder="USA" required />
    </form>

    <div style="margin-top: 1rem; display: flex; flex-direction: column; gap: 0.5rem;">
      <button id="paypal-btn" style="background-color:#b22222; color:#121212; font-weight:700;">Pay with PayPal</button>
      <button id="cashapp-btn" style="background-color:#00c244; color:#fff; font-weight:700;">Pay with CashApp</button>
      <button id="applepay-btn" style="background-color:#000; color:#fff; font-weight:700;">Pay with Apple Pay</button>
    </div>

    <button id="close-cart-btn" style="margin-top:1rem;">Close Cart</button>
  </section>

  <div id="cart-overlay" tabindex="-1" aria-hidden="true"></div>
</main>

<footer>
  <p>&copy; 2025 Wicked Ass Auditory. All rights reserved.</p>
  <p>Contact us: <a href="mailto:contact@wickedassauditory.com">contact@wickedassauditory.com</a></p>
</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-analytics.js";
  import {
    getAuth,
    onAuthStateChanged,
    signInWithEmailAndPassword,
    createUserWithEmailAndPassword,
    signOut
  } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
  import {
    getFirestore,
    doc,
    getDoc,
    setDoc
  } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDb5U0bC3q1zh0vwnElcF-ao7UJz9qkFhQ",
    authDomain: "wickedassguitar.firebaseapp.com",
    projectId: "wickedassguitar",
    storageBucket: "wickedassguitar.firebasestorage.app",
    messagingSenderId: "1032631519314",
    appId: "1:1032631519314:web:545800dddb9be845ad378b",
    measurementId: "G-752ZH1X1BR"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const productsList = document.getElementById("products-list");
  const cartSection = document.getElementById("cart-section");
  const cartItemsDiv = document.getElementById("cart-items");
  const cartTotalSpan = document.getElementById("cart-total");

  const userInfoDiv = document.getElementById("user-info");
  const userEmailSpan = document.getElementById("user-email");
  const logoutBtn = document.getElementById("logout-btn");
  const loginFormDiv = document.getElementById("login-form");
  const emailInput = document.getElementById("email");
  const passwordInput = document.getElementById("password");
  const loginBtn = document.getElementById("login-btn");
  const signupBtn = document.getElementById("signup-btn");
  const authMessageP = document.getElementById("auth-message");

  const cartLink = document.getElementById("cart-link");
  const cartCountSpan = document.getElementById("cart-count");

  const promoCodeInput = document.getElementById("promo-code-input");
  const applyPromoBtn = document.getElementById("apply-promo-btn");
  const promoMessage = document.getElementById("promo-message");

  const closeCartBtn = document.getElementById("close-cart-btn");
  const cartOverlay = document.getElementById("cart-overlay");

  const paypalBtn = document.getElementById("paypal-btn");
  const cashappBtn = document.getElementById("cashapp-btn");
  const applePayBtn = document.getElementById("applepay-btn");

  const shippingForm = document.getElementById("shipping-form");

  let currentUser = null;
  let cart = [];
  let appliedDiscount = 0;

  const products = [
    {id: 1, name: "Electric Guitar", price: 799, image: "images/guitar1.jpg"},
    {id: 2, name: "Guitar Amplifier", price: 299, image: "images/amp1.jpg"},
    {id: 3, name: "Dynamic Microphone", price: 149, image: "images/mic1.jpg"},
    {id: 4, name: "Pickup Set", price: 99, image: "images/pickup1.jpg"},
    {id: 5, name: "Microphone Stand", price: 49, image: "images/micstand1.jpg"},
    {id: 6, name: "Guitar Cable", price: 19, image: "images/cable1.jpg"},
    {id: 7, name: "Condenser Microphone", price: 249, image: "images/mic2.jpg"},
    {id: 8, name: "Amp Headphone", price: 89, image: "images/headphone1.jpg"}
  ];

  // Renders the product list on the shop page
  function renderProducts() {
    productsList.innerHTML = "";
    products.forEach(product => {
      const div = document.createElement("div");
      div.className = "product-card";
      div.innerHTML = `
        <img src="${product.image}" alt="${product.name}" />
        <h4>${product.name}</h4>
        <p>$${product.price.toFixed(2)}</p>
        <button data-id="${product.id}">Add to Cart</button>
      `;
      productsList.appendChild(div);
    });
  }

  // Load cart from Firestore or localStorage
  async function loadCart() {
    if (currentUser) {
      try {
        const docRef = doc(db, "carts", currentUser.uid);
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
          cart = docSnap.data().items || [];
        } else {
          cart = [];
        }
      } catch (error) {
        console.error("Error loading cart:", error);
        cart = [];
      }
    } else {
      const storedCart = localStorage.getItem("cart");
      cart = storedCart ? JSON.parse(storedCart) : [];
    }
    updateCartCount();
  }

  // Save cart to Firestore or localStorage
  async function saveCart() {
    if (currentUser) {
      try {
        await setDoc(doc(db, "carts", currentUser.uid), {items: cart});
      } catch (error) {
        console.error("Error saving cart:", error);
      }
    } else {
      localStorage.setItem("cart", JSON.stringify(cart));
    }
    updateCartCount();
  }

  // Updates the cart count in header nav
  function updateCartCount() {
    const totalCount = cart.reduce((acc, item) => acc + item.quantity, 0);
    cartCountSpan.textContent = totalCount;
  }

  // Renders the cart items inside the modal
  function renderCart() {
    cartItemsDiv.innerHTML = "";
    if (cart.length === 0) {
      cartItemsDiv.innerHTML = "<p>Your cart is empty.</p>";
      cartTotalSpan.textContent = "0.00";
      return;
    }
    let total = 0;
    cart.forEach(item => {
      const product = products.find(p => p.id === item.id);
      if (!product) return;
      total += product.price * item.quantity;
      const div = document.createElement("div");
      div.className = "cart-item";
      div.innerHTML = `
        <span>${product.name} x${item.quantity}</span>
        <span>$${(product.price * item.quantity).toFixed(2)}</span>
        <button data-id="${item.id}" aria-label="Remove ${product.name} from cart">&times;</button>
      `;
      cartItemsDiv.appendChild(div);
    });
    let discountedTotal = total * (1 - appliedDiscount);
    cartTotalSpan.textContent = discountedTotal.toFixed(2);
  }

  // Adds a product to the cart (or increases quantity)
  function addToCart(id) {
    const found = cart.find(item => item.id === id);
    if (found) {
      found.quantity++;
    } else {
      cart.push({id, quantity: 1});
    }
    saveCart();
    renderCart();
  }

  // Remove item from cart
  function removeFromCart(id) {
    cart = cart.filter(item => item.id !== id);
    saveCart();
    renderCart();
  }

  // Open the cart modal and overlay
  function openCart() {
    renderCart();
    promoMessage.textContent = "";
    appliedDiscount = 0;
    promoCodeInput.value = "";
    cartSection.style.display = "block";
    cartOverlay.style.display = "block";
    cartSection.focus();
  }

  // Close the cart modal and overlay
  function closeCart() {
    cartSection.style.display = "none";
    cartOverlay.style.display = "none";
  }

  // Validate shipping address form, returns boolean
  function validateShippingForm() {
    const form = shippingForm;
    if (!form["fullName"].value.trim()) return false;
    if (!form["addressLine1"].value.trim()) return false;
    if (!form["city"].value.trim()) return false;
    if (!form["state"].value.trim()) return false;
    if (!form["zip"].value.trim()) return false;
    if (!form["country"].value.trim()) return false;
    return true;
  }

  // Event listeners
  productsList.addEventListener("click", e => {
    if (e.target.tagName === "BUTTON") {
      const id = Number(e.target.getAttribute("data-id"));
      addToCart(id);
    }
  });

  cartItemsDiv.addEventListener("click", e => {
    if (e.target.tagName === "BUTTON") {
      const id = Number(e.target.getAttribute("data-id"));
      removeFromCart(id);
    }
  });

  cartLink.addEventListener("click", e => {
    e.preventDefault();
    openCart();
  });

  closeCartBtn.addEventListener("click", closeCart);
  cartOverlay.addEventListener("click", closeCart);

  applyPromoBtn.addEventListener("click", () => {
    const code = promoCodeInput.value.trim().toLowerCase();
    const promos = {
      rock10: 0.10,
      amp20: 0.20,
      guitar5: 0.05
    };
    if (promos[code]) {
      appliedDiscount = promos[code];
      promoMessage.textContent = `Promo code applied! You saved ${(appliedDiscount * 100).toFixed(0)}%.`;
      renderCart();
    } else {
      promoMessage.textContent = "Invalid promo code.";
      appliedDiscount = 0;
      renderCart();
    }
  });

  paypalBtn.addEventListener("click", () => {
    if (cart.length === 0) {
      alert("Your cart is empty.");
      return;
    }
    if (!validateShippingForm()) {
      alert("Please fill in all required shipping address fields.");
      return;
    }

    let total = 0;
    cart.forEach(item => {
      const product = products.find(p => p.id === item.id);
      if (product) total += product.price * item.quantity;
    });
    let discountedTotal = total * (1 - appliedDiscount);

    // Build PayPal URL
    const paypalUrl = new URL("https://www.paypal.com/cgi-bin/webscr");
    paypalUrl.searchParams.set("cmd", "_xclick");
    paypalUrl.searchParams.set("business", "YOUR_PAYPAL_EMAIL"); // REPLACE HERE
    paypalUrl.searchParams.set("currency_code", "USD");
    paypalUrl.searchParams.set("amount", discountedTotal.toFixed(2));
    paypalUrl.searchParams.set("item_name", "Wicked Ass Auditory Order");

    // Append shipping info as custom fields (optional, limited length)
    const shippingInfo = `${shippingForm["fullName"].value}, ${shippingForm["addressLine1"].value}, ${shippingForm["addressLine2"].value}, ${shippingForm["city"].value}, ${shippingForm["state"].value}, ${shippingForm["zip"].value}, ${shippingForm["country"].value}`;
    paypalUrl.searchParams.set("custom", shippingInfo);

    window.open(paypalUrl.toString(), "_blank");
  });

  cashappBtn.addEventListener("click", () => {
    // Replace with your CashApp payment link
    const cashAppLink = "https://cash.app/$DevinSlifer0"; // REPLACE HERE
    window.open(cashAppLink, "_blank");
  });

  applePayBtn.addEventListener("click", () => {
    alert("Apple Pay integration requires HTTPS and a payment processor. This is a placeholder.");
  });

  // Firebase Auth handlers
  loginBtn.addEventListener("click", async () => {
    authMessageP.textContent = "";
    try {
      await signInWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
    } catch (error) {
      authMessageP.textContent = "Login failed: " + error.message;
    }
  });

  signupBtn.addEventListener("click", async () => {
    authMessageP.textContent = "";
    try {
      await createUserWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
    } catch (error) {
      authMessageP.textContent = "Signup failed: " + error.message;
    }
  });

  logoutBtn.addEventListener("click", () => {
    signOut(auth);
  });

  onAuthStateChanged(auth, user => {
    currentUser = user;
    if (user) {
      userInfoDiv.style.display = "block";
      loginFormDiv.style.display = "none";
      userEmailSpan.textContent = user.email;
      loadCart().then(() => renderCart());
    } else {
      userInfoDiv.style.display = "none";
      loginFormDiv.style.display = "block";
      cart = [];
      saveCart();
      renderCart();
    }
  });

  // Initial rendering
  renderProducts();
  loadCart();
</script>

</body>
</html>
